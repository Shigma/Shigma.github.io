<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>更新器与循环器 | web-stg</title>
    <meta name="description" content="一个基于 JavaScript 的弹幕引擎">
    
    
    <link rel="preload" href="/assets/css/0.styles.ce45930c.css" as="style"><link rel="preload" href="/assets/js/app.a4fde81f.js" as="script"><link rel="preload" href="/assets/js/2.31827bf9.js" as="script"><link rel="preload" href="/assets/js/10.1c25f95b.js" as="script"><link rel="prefetch" href="/assets/js/11.391bb45a.js"><link rel="prefetch" href="/assets/js/12.96a29660.js"><link rel="prefetch" href="/assets/js/13.1378f399.js"><link rel="prefetch" href="/assets/js/14.d7439ee6.js"><link rel="prefetch" href="/assets/js/15.7f404d4e.js"><link rel="prefetch" href="/assets/js/16.cb66a713.js"><link rel="prefetch" href="/assets/js/17.a3cc581b.js"><link rel="prefetch" href="/assets/js/3.cf0a09b1.js"><link rel="prefetch" href="/assets/js/4.be213138.js"><link rel="prefetch" href="/assets/js/5.f7524784.js"><link rel="prefetch" href="/assets/js/6.18f85570.js"><link rel="prefetch" href="/assets/js/7.e9a37bb2.js"><link rel="prefetch" href="/assets/js/8.78743ed3.js"><link rel="prefetch" href="/assets/js/9.e805e8c4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ce45930c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">web-stg</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/API/" class="nav-link router-link-active">API</a></div><div class="nav-item"><a href="https://github.com/Shigma/STG" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/API/" class="nav-link router-link-active">API</a></div><div class="nav-item"><a href="https://github.com/Shigma/STG" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/API/" class="sidebar-link">API</a></li><li><a href="/API/updater-and-looping.html" class="active sidebar-link">更新器与循环器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/API/updater-and-looping.html#更新器-updater" class="sidebar-link">更新器 (Updater)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/API/updater-and-looping.html#new-updater" class="sidebar-link">new Updater()</a></li><li class="sidebar-sub-header"><a href="/API/updater-and-looping.html#updater-settask-callback-index-preserve" class="sidebar-link">updater.setTask(callback, index?, preserve?)</a></li><li class="sidebar-sub-header"><a href="/API/updater-and-looping.html#updater-removetask-id" class="sidebar-link">updater.removeTask(id?)</a></li><li class="sidebar-sub-header"><a href="/API/updater-and-looping.html#updater-settimeout-ticks-callback" class="sidebar-link">updater.setTimeout(ticks, callback)</a></li><li class="sidebar-sub-header"><a href="/API/updater-and-looping.html#updater-setinterval-interval-times-offset-callback" class="sidebar-link">updater.setInterval(interval, times?, offset?, callback)</a></li></ul></li><li class="sidebar-sub-header"><a href="/API/updater-and-looping.html#循环器-looping" class="sidebar-link">循环器 (Looping)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/API/updater-and-looping.html#new-looping-options" class="sidebar-link">new Looping(options?)</a></li><li class="sidebar-sub-header"><a href="/API/updater-and-looping.html#looping-pause-slient" class="sidebar-link">looping.pause(slient?)</a></li><li class="sidebar-sub-header"><a href="/API/updater-and-looping.html#looping-resume-slient" class="sidebar-link">looping.resume(slient?)</a></li><li class="sidebar-sub-header"><a href="/API/updater-and-looping.html#looping-toggle-slient" class="sidebar-link">looping.toggle(slient?)</a></li><li class="sidebar-sub-header"><a href="/API/updater-and-looping.html#looping-getstatus" class="sidebar-link">looping.getStatus()</a></li></ul></li></ul></li><li><a href="/API/point-and-coordinate.html" class="sidebar-link">点与坐标系</a></li><li><a href="/API/bullet-and-barrage.html" class="sidebar-link">子弹与弹幕</a></li><li><a href="/API/player-and-scene.html" class="sidebar-link">自机与场景</a></li><li><a href="/API/utils.html" class="sidebar-link">实用工具</a></li></ul> </div> <div class="page"> <div class="content default"><h1 id="更新器与循环器"><a href="#更新器与循环器" aria-hidden="true" class="header-anchor">#</a> 更新器与循环器</h1> <p>这个库中使用的最基本概念是更新器 (Updater). 一个更新器只需实现两个接口: <code>update</code> 和 <code>render</code>, 它们分别表示一个实例在更新和渲染时调用的钩子函数. 与更新器相对的另一个概念是循环器 (Looping), 它负责按照特定的顺序调用子实例的更新和渲染, 达到管理整个流程的目的. 可以说 Updater 管理了每一个对象的运动状态 (包括但不限于自机, 敌机, 子弹), 而 Looping 负责调控整体的运转和渲染的进行.</p> <p>下面我们将分别介绍 Updater 和 Looping 两个基类.</p> <h3 id="关于更新策略"><a href="#关于更新策略" aria-hidden="true" class="header-anchor">#</a> 关于更新策略</h3> <p>上面的基本概念意味着我们的更新和渲染流程是分离的. 为什么要这么做呢? 在过去的版本曾经尝试过更新和渲染绑定在同一个函数中的做法. 它的一个最显著的负面影响便是渲染性能会影响自身的重绘速率 (比如这一秒屏幕上只有 10 颗子弹, 下一秒突然变成了 100 颗, 导致程序回调性能发生变化). 而这又导致了更新会受到渲染的影响, 从而画不出完美的图形.</p> <p>而如果我们将更新与渲染分离, 则主循环可以尽可能地与显示器实现垂直同步, 同时副循环负责按照固定的速率 (一般为 60 fps) 进行更新, 遇到掉帧现象时也可以稍微加快循环速度, 进行&quot;补帧&quot;处理. 这也是众多 STG 游戏都采取的策略.</p> <h2 id="更新器-updater"><a href="#更新器-updater" aria-hidden="true" class="header-anchor">#</a> 更新器 (Updater)</h2> <h3 id="new-updater"><a href="#new-updater" aria-hidden="true" class="header-anchor">#</a> new Updater()</h3> <p>返回一个 Updater 实例.</p> <h3 id="updater-settask-callback-index-preserve"><a href="#updater-settask-callback-index-preserve" aria-hidden="true" class="header-anchor">#</a> updater.setTask(callback, index?, preserve?)</h3> <ul><li><code>callback</code>: 回调函数, 带有一个参数 <code>tick</code>, 表示回调进行时的刻数.</li> <li><code>index</code>: 插入任务钩子的位置, 默认为 <code>Infinity</code>, 即全部任务的最后面.</li> <li><code>preserve</code>: 执行完毕后是否保留这个任务, 默认为 <code>true</code>.</li> <li>返回值: 一个正整数 <code>id</code>, 表示当前任务的序号, 可以用于 <code>updater.removeTask</code>.</li></ul> <h3 id="updater-removetask-id"><a href="#updater-removetask-id" aria-hidden="true" class="header-anchor">#</a> updater.removeTask(id?)</h3> <ul><li><code>id</code>: 要移除的任务 <code>id</code>. 如果在某个钩子内部调用时, 此选项可以省略, 表示任务完成后移除这个任务本身.</li></ul> <h3 id="updater-settimeout-ticks-callback"><a href="#updater-settimeout-ticks-callback" aria-hidden="true" class="header-anchor">#</a> updater.setTimeout(ticks, callback)</h3> <ul><li><code>ticks</code>: 执行该任务前要等待的刻数.</li> <li><code>callback</code>: 回调函数, 带有一个参数 <code>tick</code>, 表示回调进行时的刻数.</li></ul> <h3 id="updater-setinterval-interval-times-offset-callback"><a href="#updater-setinterval-interval-times-offset-callback" aria-hidden="true" class="header-anchor">#</a> updater.setInterval(interval, times?, offset?, callback)</h3> <ul><li><code>interval</code>: 两次执行间要等待的刻数.</li> <li><code>times</code>: 一共要执行该任务的次数, 默认为 <code>Infinity</code>.</li> <li><code>offset</code>: 执行第一次任务前要额外等待的刻数, 默认为 <code>0</code>.</li> <li><code>callback</code>: 回调函数, 带有两个参数 <code>tick</code> 和 <code>wave</code>, 分别表示回调进行时的刻数和当前回调是第几次.</li></ul> <h2 id="循环器-looping"><a href="#循环器-looping" aria-hidden="true" class="header-anchor">#</a> 循环器 (Looping)</h2> <h3 id="new-looping-options"><a href="#new-looping-options" aria-hidden="true" class="header-anchor">#</a> new Looping(options?)</h3> <p>返回一个 Looping 实例. <code>options</code> 是一个对象, 可以包含下面的属性:</p> <ul><li><code>options.tickRate</code>: 更新执行的频率, 默认为 <code>60</code>.</li> <li><code>options.tickStorage</code>: 存储更新数据的个数. 这决定了统计数据的样本大小, 默认为 <code>60</code>. (也就是说, 在默认的配置下, 统计得到的帧率和处理落率是由最近 1s 内的更新数据计算得到的.)</li> <li><code>options.maxInterpolation</code>: 单次最大补帧数量. 当发生大量掉帧时 (这可能由于电脑性能过低, 更新或渲染负荷过大等原因), 将不会处理超过这个数量的补帧. 默认值为 <code>5</code>.</li></ul> <h3 id="looping-pause-slient"><a href="#looping-pause-slient" aria-hidden="true" class="header-anchor">#</a> looping.pause(slient?)</h3> <h3 id="looping-resume-slient"><a href="#looping-resume-slient" aria-hidden="true" class="header-anchor">#</a> looping.resume(slient?)</h3> <h3 id="looping-toggle-slient"><a href="#looping-toggle-slient" aria-hidden="true" class="header-anchor">#</a> looping.toggle(slient?)</h3> <p>停止 / 恢复 / 切换该实例下的更新和渲染.</p> <ul><li><code>slient</code>: 是否触发相应的 <code>pause</code> 或 <code>resume</code> 事件, 默认为 <code>false</code>.</li></ul> <h3 id="looping-getstatus"><a href="#looping-getstatus" aria-hidden="true" class="header-anchor">#</a> looping.getStatus()</h3> <p>获得当前的状态数据. 返回一个 <code>LoopingStatus</code> 对象, 包含下列属性:</p> <ul><li><code>stat.tickRate</code>: 当前帧率.</li> <li><code>stat.dropRate</code>: 当前处理落率.</li></ul> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>当前的处理落率计算方法可能存在一定的问题, 导致数值偏大.</p></div></div> <!----> <!----> </div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.a4fde81f.js" defer></script><script src="/assets/js/2.31827bf9.js" defer></script><script src="/assets/js/10.1c25f95b.js" defer></script>
  </body>
</html>
